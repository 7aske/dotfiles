local colorsFile = '.conkycolors' 

function file_exists(file)
    local f = io.open(file, "rb")
    if f then f:close() end
    return f ~= nil
end

function load_colors(file)
    if not file_exists(file) then
        print("'.conkycolors' file not found")
    end
    counter = 1
    for line in io.lines(file) do
        conky.config["color" .. counter] = line
        counter =  counter + 1
    end
end
  
conky.config = {
    own_window_hints = 'undecorated,below,sticky,skip_taskbar,skip_pager',
    own_window_transparent = false,
    own_window_argb_visual = true,
    own_window_argb_value = 70,
    own_window_colour = '090909',
    alignment = 'middle_right',
    background = true,
    border_width = 1,
    cpu_avg_samples = 3,
    default_shade_color = '090909',
    double_buffer = true,
    use_xft = true,
    font = 'Ubuntu Mono:size=11',
    -- gap_x = 5,
    gap_y = 0,
    net_avg_samples = 2,
    no_buffers = true,
    out_to_console = false,
    out_to_ncurses = false,
    out_to_stderr = false,
    out_to_x = true,
    extra_newline = false,
    own_window = true,
    own_window_class = 'Conky',
    own_window_type = 'desktop',
    update_interval = 1.0,
    uppercase = false,
    -- color1 = lines[1],
    -- color2 = lines[2],
    default_bar_width = 160,
}
load_colors(colorsFile)

conky.text = [[
${voffset 8}$color1${font Bitstream Vera Sans:size=16}${time %A}$font\
${voffset -8}$alignr$color${font Bitstream Vera Sans:size=38}${time %e}$font
$color${voffset -30}$color${font Bitstream Vera Sans:size=18}${time %b}$font\
${voffset -3} $color${font Bitstream Vera Sans:size=20}${time %Y}$font$color1$hr

$nodename $kernel ($machine)
${color2}Uptime:$color $uptime

${color1}CPU $color$hr

${color2}Name:$color${exec lscpu | grep name | tr -s ' ' | cut -d ':' -f2 | cut -c -28}
$color${cpubar cpu1 8, 160}  ${cpubar cpu9  8, 160}
$color${cpubar cpu2 8, 160}  ${cpubar cpu10 8, 160}
$color${cpubar cpu3 8, 160}  ${cpubar cpu11 8, 160}
$color${cpubar cpu4 8, 160}  ${cpubar cpu12 8, 160}
$color${cpubar cpu5 8, 160}  ${cpubar cpu13 8, 160}
$color${cpubar cpu6 8, 160}  ${cpubar cpu14 8, 160}
$color${cpubar cpu7 8, 160}  ${cpubar cpu15 8, 160}
$color${cpubar cpu8 8, 160}  ${cpubar cpu16 8, 160}
${color2}Temp:$color ${exec sensors | grep Tdie | awk '{print $2}'} ${color2}Procs: $color${processes} ${color2}Freq: $color${freq_g}GHz${alignr}${color2}Total: ${color}${cpu cpu0}%

$color2${top name 1}$alignr$color${top cpu 1}%
$color2${top name 2}$alignr$color${top cpu 2}%
$color2${top name 3}$alignr$color${top cpu 3}%
$color2${top name 4}$alignr$color${top cpu 4}%

${color1}GPU $color$hr

${color2}Name: $color${exec nvidia-smi --format=csv,noheader --query-gpu=name}
$color${execbar nvidia-smi --format=csv,noheader --query-gpu=utilization.gpu}  $color${execbar nvidia-smi --format=csv,noheader --query-gpu=utilization.memory}
${color2}Utilization: $color${exec nvidia-smi --format=csv,noheader --query-gpu=utilization.gpu}$alignr${color2}Memory: $color${exec nvidia-smi --format=csv,noheader --query-gpu=memory.used | cut -d ' ' -f1}/${exec nvidia-smi --format=csv,noheader --query-gpu=memory.total} \

${color2}Temp:$color +${exec nvidia-smi --format=csv,noheader --query-gpu=temperature.gpu}Â°C \
${color2}State: $color${exec nvidia-smi --format=csv,noheader --query-gpu=pstate}

${color1}RAM $color$hr

${color2}Percent:$color $memperc% ${membar 8, 240}
${color2}Usage:  $color $mem / $memmax

$color2${top_mem name 1}$alignr$color${top_mem pid 1}${top_mem cpu 1} ${top_mem mem_res 1}
$color2${top_mem name 2}$alignr$color${top_mem pid 2}${top_mem cpu 2} ${top_mem mem_res 2}
$color2${top_mem name 3}$alignr$color${top_mem pid 3}${top_mem cpu 3} ${top_mem mem_res 3}
$color2${top_mem name 4}$alignr$color${top_mem pid 4}${top_mem cpu 4} ${top_mem mem_res 4}

${color1}File systems $color $hr

${color2}nvme0n1p2 $color${fs_free /}/${fs_size /} ${fs_bar 6 /}
${color2}sda1      $color${fs_free /mnt/storage0}/${fs_size /mnt/storage0}  ${fs_bar 6 /mnt/storage0}
${color2}I/O: $color$diskio_write / $diskio_read

${color1}Networking $color$hr
${if_existing /proc/net/route enp4s0}
${color2}UP:$color ${upspeed enp4s0}${color2}${alignr 10}DOWN: $color ${downspeed enp4s0}
${upspeedgraph enp4s0 40,160 -l}  ${downspeedgraph enp4s0 40,160 -l}
${endif}
${color1}Repositories $color$hr

${execi 600 CODE=/home/nik/Code /home/nik/Code/c/cgs/build/cgs --no-color}
]]